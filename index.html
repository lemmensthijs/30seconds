<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <title>EHBO 30 Seconds</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      background: #000;
      color: #f5f5f5;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }

    .app {
      width: 100%;
      max-width: 480px;
      padding: 16px;
      position: relative;
    }

    .title {
      text-align: center;
      font-size: 1.4rem;
      margin-bottom: 8px;
      font-weight: 600;
    }

    .subtitle {
      text-align: center;
      font-size: 0.9rem;
      color: #aaa;
      margin-bottom: 16px;
    }

    .card {
      background: #111;
      border-radius: 16px;
      padding: 16px;
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.6);
    }

    .word-display {
      min-height: 80px;
      border-radius: 12px;
      border: 1px solid #333;
      background: radial-gradient(circle at top, #222 0, #111 60%);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 12px;
      margin-bottom: 12px;
      text-align: center;
    }

    .word-text {
      font-size: 1.8rem;
      font-weight: 700;
      letter-spacing: 0.04em;
    }

    .placeholder {
      font-size: 0.95rem;
      color: #666;
    }

    .taboo-title {
      font-size: 0.8rem;
      color: #888;
      margin-top: 6px;
    }

    .taboo-list {
      font-size: 0.85rem;
      color: #ffb74d;
      margin-top: 2px;
    }

    .timer-section {
      margin-top: 12px;
      margin-bottom: 16px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
    }

    .timer-display {
      font-size: 2.4rem;
      font-weight: 700;
      letter-spacing: 0.08em;
    }

    .status-text {
      font-size: 0.85rem;
      color: #999;
    }

    .hourglass-container {
      width: 80px;
      height: 140px;
      position: relative;
    }

    .hourglass-frame {
      position: absolute;
      inset: 0;
      border-radius: 12px;
      border: 2px solid #555;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .hourglass-shape {
      width: 40px;
      height: 100px;
      position: relative;
    }

    .triangle-top,
    .triangle-bottom {
      width: 0;
      height: 0;
      border-left: 20px solid transparent;
      border-right: 20px solid transparent;
      position: absolute;
      left: 0;
    }

    .triangle-top {
      border-bottom: 45px solid #555;
      top: 0;
    }

    .triangle-bottom {
      border-top: 45px solid #555;
      bottom: 0;
    }

    .sand-fill {
      position: absolute;
      left: 4px;
      right: 4px;
      top: 4px;
      bottom: 4px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      pointer-events: none;
    }

    .sand-top,
    .sand-bottom {
      width: 100%;
      transform-origin: center;
    }

    .sand-top {
      height: 45%;
      display: flex;
      justify-content: center;
      align-items: flex-end;
    }

    .sand-bottom {
      height: 45%;
      display: flex;
      justify-content: center;
      align-items: flex-start;
    }

    .sand-top-inner,
    .sand-bottom-inner {
      width: 0;
      height: 0;
      border-left: 16px solid transparent;
      border-right: 16px solid transparent;
    }

    .sand-top-inner {
      border-bottom: 40px solid #ffca28;
      transform-origin: bottom center;
    }

    .sand-bottom-inner {
      border-top: 40px solid #ffca28;
      transform-origin: top center;
    }

    .controls {
      display: flex;
      gap: 8px;
      margin-top: 8px;
      flex-wrap: wrap;
      justify-content: center;
    }

    button {
      border: none;
      border-radius: 999px;
      padding: 12px 14px;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.1s ease, box-shadow 0.1s ease, filter 0.1s ease;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }

    button:active {
      transform: translateY(1px) scale(0.98);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
      filter: brightness(0.95);
    }

    .word-btn {
      background: linear-gradient(135deg, #42a5f5, #1e88e5);
      color: #fff;
      flex: 1 1 40%;
      min-width: 110px;
    }

    .new-btn {
      background: linear-gradient(135deg, #66bb6a, #43a047);
      color: #fff;
      flex: 1 1 25%;
      min-width: 90px;
    }

    .time-btn {
      background: linear-gradient(135deg, #ab47bc, #8e24aa);
      color: #fff;
      flex: 1 1 20%;
      min-width: 80px;
    }

    .help-btn {
      background: linear-gradient(135deg, #ffca28, #ffa000);
      color: #222;
      flex: 1 1 20%;
      min-width: 80px;
    }

    .settings {
      margin-top: 14px;
      font-size: 0.8rem;
      color: #888;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .settings label {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .settings input[type="checkbox"] {
      accent-color: #42a5f5;
    }

    .tip {
      font-size: 0.8rem;
      color: #666;
      margin-top: 4px;
    }

    .overlay {
      position: absolute;
      inset: 0;
      background: rgba(0, 0, 0, 0.85);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 50;
    }

    .overlay-content {
      background: #181818;
      border-radius: 18px;
      padding: 20px 16px;
      max-width: 420px;
      width: 100%;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.8);
    }

    .overlay-title {
      font-size: 1.2rem;
      font-weight: 600;
      margin-bottom: 8px;
      text-align: center;
    }

    .overlay-text {
      font-size: 0.9rem;
      color: #ddd;
      line-height: 1.4;
      margin-bottom: 12px;
    }

    .overlay-list {
      font-size: 0.9rem;
      color: #ccc;
      margin-bottom: 16px;
    }

    .overlay-list li {
      margin-left: 18px;
      margin-bottom: 4px;
    }

    .overlay-footer {
      display: flex;
      justify-content: center;
      margin-top: 8px;
    }

    .back-btn {
      background: linear-gradient(135deg, #42a5f5, #1e88e5);
      color: #fff;
      padding: 10px 22px;
      border-radius: 999px;
      border: none;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
    }

    .back-btn:active {
      transform: translateY(1px) scale(0.98);
    }

    .time-options {
      display: flex;
      justify-content: center;
      gap: 8px;
      flex-wrap: wrap;
      margin-top: 8px;
      margin-bottom: 12px;
    }

    .time-option-btn {
      border-radius: 999px;
      padding: 8px 14px;
      font-size: 0.9rem;
      border: 1px solid #555;
      background: #222;
      color: #ddd;
      cursor: pointer;
    }

    .time-option-btn.selected {
      background: #ab47bc;
      border-color: #e1bee7;
      color: #fff;
      box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.1);
    }

    .current-time-label {
      font-size: 0.85rem;
      color: #bbb;
      text-align: center;
    }

    @media (max-width: 360px) {
      .word-text {
        font-size: 1.4rem;
      }
      .timer-display {
        font-size: 2rem;
      }
    }
  </style>
</head>
<body>
<div class="app">
  <div class="title">EHBO 30 Seconds</div>
  <div class="subtitle">Houd "Woord" ingedrukt om het woord te zien. Loslaten start de tijd.</div>

  <div class="card">
    <div class="word-display">
      <div id="wordText" class="word-text" style="display:none;"></div>
      <div id="placeholder" class="placeholder">
        Druk op "Woord" om het eerste woord klaar te zetten.
      </div>
      <div id="tabooWrapper" style="display:none;">
        <div class="taboo-title">Deze woorden mag je niet zeggen:</div>
        <div id="tabooList" class="taboo-list"></div>
      </div>
    </div>

    <div class="timer-section">
      <div id="timerDisplay" class="timer-display">30.0</div>
      <div id="statusText" class="status-text">Klaar voor de volgende ronde.</div>

      <div class="hourglass-container">
        <div class="hourglass-frame">
          <div class="hourglass-shape">
            <div class="triangle-top"></div>
            <div class="triangle-bottom"></div>
            <div class="sand-fill">
              <div class="sand-top">
                <div id="sandTopInner" class="sand-top-inner"></div>
              </div>
              <div class="sand-bottom">
                <div id="sandBottomInner" class="sand-bottom-inner"></div>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>

    <div class="controls">
      <button id="wordBtn" class="word-btn">Woord</button>
      <button id="newBtn" class="new-btn">Nieuw woord</button>
      <button id="timeBtn" class="time-btn">Tijd</button>
      <button id="helpBtn" class="help-btn">Uitleg</button>
    </div>

    <div class="settings">
      <label>
        <input type="checkbox" id="tiltStartToggle" checked>
        Timer mag ook starten als telefoon plat op tafel ligt.
      </label>
      <div class="tip">
        Voor de plat-lig functie is op sommige telefoons een toestemming voor bewegingssensoren nodig.
      </div>
    </div>
  </div>

  <!-- Uitleg overlay -->
  <div id="helpOverlay" class="overlay">
    <div class="overlay-content">
      <div class="overlay-title">Uitleg van het spel</div>
      <p class="overlay-text">
        EHBO 30 Seconds speel je met minimaal twee spelers. Eén speler ziet het woord op het scherm, de andere speler moet het woord raden.
      </p>
      <ul class="overlay-list">
        <li>Druk op de knop Woord en houd deze ingedrukt om het woord en de verboden woorden te zien.</li>
        <li>Zodra je de knop loslaat, gaat de tijd lopen en heb je de ingestelde tijd om het woord te omschrijven.</li>
        <li>Je mag de verboden woorden niet gebruiken, omdat die vertellen hoe het letsel is ontstaan.</li>
        <li>De andere speler ziet de verboden woorden niet tijdens het raden.</li>
      </ul>
      <div class="overlay-footer">
        <button id="backBtn" class="back-btn">Terug</button>
      </div>
    </div>
  </div>

  <!-- Tijd overlay -->
  <div id="timeOverlay" class="overlay">
    <div class="overlay-content">
      <div class="overlay-title">Kies de tijd per ronde</div>
      <p class="overlay-text">
        Kies hoeveel seconden een speler krijgt om het woord te omschrijven.
      </p>
      <div class="time-options">
        <button class="time-option-btn" data-seconds="10">10 s</button>
        <button class="time-option-btn" data-seconds="15">15 s</button>
        <button class="time-option-btn" data-seconds="20">20 s</button>
        <button class="time-option-btn" data-seconds="25">25 s</button>
        <button class="time-option-btn" data-seconds="30">30 s</button>
      </div>
      <div id="currentTimeLabel" class="current-time-label">
        Huidige tijd per ronde: 30 s
      </div>
      <div class="overlay-footer">
        <button id="timeBackBtn" class="back-btn">Terug</button>
      </div>
    </div>
  </div>
</div>

<script>
  const WORDS = [
    { term: "Bewustzijn", taboo: [] },
    { term: "Ademhaling", taboo: [] },
    { term: "112 bellen", taboo: [] },
    { term: "Eigen veiligheid", taboo: [] },
    { term: "Stabiele zijligging", taboo: [] },
    { term: "Reanimatie", taboo: [] },
    { term: "AED", taboo: [] },

    { term: "Verslikking", taboo: ["snel eten", "snel drinken", "stukje eten in de keel"] },
    { term: "Buikstoten", taboo: [] },

    { term: "Bloedneus", taboo: ["klap op de neus", "in de neus peuteren", "hard snuiten"] },
    { term: "Flauwvallen", taboo: ["lang stilstaan", "weinig eten", "spannende situatie"] },

    { term: "Hoofdwond", taboo: ["val op het hoofd", "botsing tegen iets hards", "klap tegen het hoofd"] },
    { term: "Schaafwond", taboo: ["vallen op straat", "over de grond schuiven", "glijden over een ruwe ondergrond"] },
    { term: "Snijwond", taboo: ["mes", "glas", "scherp voorwerp"] },

    { term: "Brandwond", taboo: ["vuur", "hete vloeistof", "hete pan", "elektriciteit", "chemisch middel"] },
    { term: "Blaar", taboo: ["nieuwe schoenen", "lange wandeling", "wrijving"] },

    { term: "Botbreuk", taboo: ["val", "auto-ongeluk", "sportongeval"] },
    { term: "Kneuzing", taboo: ["stoten tegen iets", "vallen", "botsing"] },
    { term: "Verstuiking", taboo: ["enkel verzwikken", "verkeerd neerkomen", "voet omklappen"] },
    { term: "Ontwrichting", taboo: ["hard vallen op arm of schouder", "hard trekken aan een gewricht", "sportongeval"] },

    { term: "Nekletsel", taboo: ["auto-ongeluk", "duiken in ondiep water", "val van hoogte"] },

    { term: "Allergie", taboo: ["pinda's", "noten", "insectensteek", "bepaalde medicijnen"] },
    { term: "Anafylaxie", taboo: ["pinda's", "noten", "wespensteek", "penicilline"] },

    { term: "Epilepsie", taboo: ["knipperend licht", "flikkerende beelden", "slaaptekort"] },

    { term: "Hypo", taboo: ["te veel insuline", "te weinig eten", "zware inspanning"] },
    { term: "Hyper", taboo: ["te weinig insuline", "veel eten", "insuline vergeten"] },

    { term: "Hyperventilatie", taboo: ["stress", "paniek", "heftige schrik"] },

    { term: "Shock", taboo: ["groot bloedverlies", "ernstig ongeluk", "zware allergische reactie"] },

    { term: "Onderkoeling", taboo: ["lang in koud water", "dunne kleding in de kou", "nat worden in de kou"] },
    { term: "Oververhitting", taboo: ["lang in de zon", "hittegolf", "zware inspanning in de warmte"] },

    { term: "Vergiftiging", taboo: ["schoonmaakmiddel drinken", "te veel medicijnen innemen", "giftige dampen inademen"] },
    { term: "Brandgevaar", taboo: ["kaarsen laten branden", "stekkerdoos overbelasten", "pan op het vuur vergeten"] },

    { term: "Bloedverlies", taboo: ["grote wond maken", "snijden met een mes", "ongeval met scherp voorwerp"] },

    { term: "Drukverband", taboo: [] },
    { term: "Wondsnelverband", taboo: [] },
    { term: "Ideaalverband", taboo: [] },
    { term: "Niet-verklevend kompres", taboo: [] },
    { term: "Zwachtel", taboo: [] },
    { term: "Mitella", taboo: [] },
    { term: "Handschoenen", taboo: [] },

    { term: "Spoelen met water", taboo: [] },
    { term: "Koelen", taboo: [] },
    { term: "Afdekken", taboo: [] },

    { term: "Pijn", taboo: [] },
    { term: "Misselijkheid", taboo: [] },
    { term: "Duizeligheid", taboo: [] },
    { term: "Bewusteloos", taboo: ["harde klap op het hoofd", "gebrek aan zuurstof", "zware botsing"] },

    { term: "Geruststellen", taboo: [] }
  ];

  let roundDuration = 30;
  let currentIndex = null;
  let timer = null;
  let remaining = roundDuration;
  let roundActive = false;
  let wordPrimedThisRound = false;
  let lastOrientationStart = 0;

  const wordTextEl = document.getElementById("wordText");
  const placeholderEl = document.getElementById("placeholder");
  const tabooWrapperEl = document.getElementById("tabooWrapper");
  const tabooListEl = document.getElementById("tabooList");
  const timerDisplayEl = document.getElementById("timerDisplay");
  const statusTextEl = document.getElementById("statusText");
  const wordBtn = document.getElementById("wordBtn");
  const newBtn = document.getElementById("newBtn");
  const helpBtn = document.getElementById("helpBtn");
  const timeBtn = document.getElementById("timeBtn");
  const helpOverlay = document.getElementById("helpOverlay");
  const backBtn = document.getElementById("backBtn");
  const timeOverlay = document.getElementById("timeOverlay");
  const timeBackBtn = document.getElementById("timeBackBtn");
  const tiltStartToggle = document.getElementById("tiltStartToggle");
  const sandTopInner = document.getElementById("sandTopInner");
  const sandBottomInner = document.getElementById("sandBottomInner");
  const currentTimeLabel = document.getElementById("currentTimeLabel");
  const timeOptionButtons = document.querySelectorAll(".time-option-btn");

  function playPling() {
    try {
      const ctx = new (window.AudioContext || window.webkitAudioContext)();
      const osc = ctx.createOscillator();
      const gain = ctx.createGain();

      osc.type = "sine";
      osc.frequency.value = 1200;

      gain.gain.setValueAtTime(0.0001, ctx.currentTime);
      gain.gain.exponentialRampToValueAtTime(0.25, ctx.currentTime + 0.05);
      gain.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + 0.9);

      osc.connect(gain);
      gain.connect(ctx.destination);
      osc.start();
      osc.stop(ctx.currentTime + 1.0);
    } catch (e) {
      // stil als audio niet kan
    }
  }

  function pickRandomIndex() {
    if (WORDS.length === 0) return null;
    if (currentIndex === null) {
      return Math.floor(Math.random() * WORDS.length);
    }
    if (WORDS.length === 1) {
      return 0;
    }
    let idx;
    do {
      idx = Math.floor(Math.random() * WORDS.length);
    } while (idx === currentIndex);
    return idx;
  }

  function updateTimerDisplay() {
    timerDisplayEl.textContent = remaining.toFixed(1);
  }

  function resetSand() {
    sandTopInner.style.transform = "scaleY(1)";
    sandBottomInner.style.transform = "scaleY(0)";
  }

  function updateSand() {
    const fraction = remaining / roundDuration;
    const topScale = Math.max(fraction, 0);
    const bottomScale = Math.min(1 - fraction, 1);
    sandTopInner.style.transform = "scaleY(" + topScale + ")";
    sandBottomInner.style.transform = "scaleY(" + bottomScale + ")";
  }

  function stopTimer() {
    if (timer) {
      clearInterval(timer);
      timer = null;
    }
    roundActive = false;
  }

  function setNewWord() {
    currentIndex = pickRandomIndex();
    remaining = roundDuration;
    updateTimerDisplay();
    resetSand();
    stopTimer();
    roundActive = false;
    wordPrimedThisRound = false;

    tabooWrapperEl.style.display = "none";
    wordTextEl.style.display = "none";
    placeholderEl.style.display = "block";
    placeholderEl.textContent = "Houd \"Woord\" ingedrukt om het woord te zien.";
    statusTextEl.textContent = "Nieuw woord klaargezet. Je kunt starten.";
  }

  function showCurrentWord() {
    if (currentIndex === null) {
      setNewWord();
    }
    const entry = WORDS[currentIndex];
    if (!entry) return;

    wordTextEl.textContent = entry.term;
    wordTextEl.style.display = "block";
    placeholderEl.style.display = "none";

    if (entry.taboo && entry.taboo.length > 0) {
      tabooListEl.textContent = entry.taboo.join(" · ");
      tabooWrapperEl.style.display = "block";
    } else {
      tabooWrapperEl.style.display = "none";
    }
  }

  function hideCurrentWord() {
    wordTextEl.style.display = "none";
    placeholderEl.style.display = "block";
    tabooWrapperEl.style.display = "none";
  }

  function startTimer() {
    if (roundActive) return;
    if (currentIndex === null) return;
    if (remaining <= 0) {
      remaining = roundDuration;
      updateTimerDisplay();
      resetSand();
    }

    roundActive = true;
    statusTextEl.textContent = "Bezig... omschrijf zo veel mogelijk.";
    const startTime = Date.now();
    const startRemaining = remaining;

    if (timer) {
      clearInterval(timer);
    }

    timer = setInterval(() => {
      const elapsed = (Date.now() - startTime) / 1000;
      const newRemaining = Math.max(0, startRemaining - elapsed);
      remaining = newRemaining;
      updateTimerDisplay();
      updateSand();

      if (remaining <= 0.05) {
        clearInterval(timer);
        timer = null;
        remaining = 0;
        updateTimerDisplay();
        updateSand();
        roundActive = false;
        wordPrimedThisRound = false;
        statusTextEl.textContent = "Tijd voorbij.";

        playPling();

        // Direct een nieuw woord klaarzetten onder de knop "Woord"
        setNewWord();
      }
    }, 100);
  }

  function onWordPressStart(evt) {
    evt.preventDefault();
    showCurrentWord();
  }

  function onWordPressEnd(evt) {
    evt.preventDefault();
    hideCurrentWord();
    if (!wordPrimedThisRound) {
      wordPrimedThisRound = true;
      remaining = roundDuration;
      updateTimerDisplay();
      resetSand();
      startTimer();
    }
  }

  wordBtn.addEventListener("mousedown", onWordPressStart);
  wordBtn.addEventListener("touchstart", onWordPressStart, { passive: false });

  wordBtn.addEventListener("mouseup", onWordPressEnd);
  wordBtn.addEventListener("mouseleave", (evt) => {
    if (evt.buttons === 0) return;
    onWordPressEnd(evt);
  });
  wordBtn.addEventListener("touchend", onWordPressEnd);
  wordBtn.addEventListener("touchcancel", onWordPressEnd);

  newBtn.addEventListener("click", () => {
    setNewWord();
  });

  // Uitleg overlay
  helpBtn.addEventListener("click", () => {
    helpOverlay.style.display = "flex";
  });

  backBtn.addEventListener("click", () => {
    helpOverlay.style.display = "none";
  });

  // Tijd overlay
  function updateTimeButtonsSelection() {
    timeOptionButtons.forEach(btn => {
      const val = Number(btn.dataset.seconds);
      if (val === roundDuration) {
        btn.classList.add("selected");
      } else {
        btn.classList.remove("selected");
      }
    });
    currentTimeLabel.textContent = "Huidige tijd per ronde: " + roundDuration + " s";
  }

  timeBtn.addEventListener("click", () => {
    updateTimeButtonsSelection();
    timeOverlay.style.display = "flex";
  });

  timeBackBtn.addEventListener("click", () => {
    timeOverlay.style.display = "none";
  });

  timeOptionButtons.forEach(btn => {
    btn.addEventListener("click", () => {
      const val = Number(btn.dataset.seconds);
      if (!isNaN(val)) {
        roundDuration = val;
        remaining = roundDuration;
        updateTimerDisplay();
        resetSand();
        stopTimer();
        wordPrimedThisRound = false;
        statusTextEl.textContent = "Tijd ingesteld op " + roundDuration + " seconden.";
        updateTimeButtonsSelection();
      }
    });
  });

  // Eerste woord klaarzetten
  setNewWord();
  updateTimerDisplay();
  updateTimeButtonsSelection();

  // Plat op tafel starten
  function handleOrientation(event) {
    if (!tiltStartToggle.checked) return;
    if (roundActive) return;
    if (!wordPrimedThisRound) return;

    const beta = event.beta;
    const gamma = event.gamma;
    if (beta == null || gamma == null) return;

    const now = Date.now();
    if (now - lastOrientationStart < 1500) return;

    const flatEnough = Math.abs(beta) < 15 && Math.abs(gamma) < 15;

    if (flatEnough) {
      lastOrientationStart = now;
      startTimer();
    }
  }

  if (window.DeviceOrientationEvent) {
    if (typeof DeviceOrientationEvent.requestPermission === "function") {
      document.body.addEventListener("click", function askPermissionOnce() {
        DeviceOrientationEvent.requestPermission()
          .then((response) => {
            if (response === "granted") {
              window.addEventListener("deviceorientation", handleOrientation);
            }
          })
          .catch(() => {});
        document.body.removeEventListener("click", askPermissionOnce);
      });
    } else {
      window.addEventListener("deviceorientation", handleOrientation);
    }
  }
</script>
</body>
</html>
